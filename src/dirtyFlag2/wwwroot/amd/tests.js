define(["require", "exports", "./dirtyFlag2.js"], function (require, exports, dirtyFlag2_js_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    QUnit.test("Simple extend test", function (assert) {
        var name;
        name = ko.observable("Joe Smith").extend({ dirtyFlag: {} });
        assert.ok(name["isDirty"]() === false, "Initialised as clean");
        name("John");
        assert.ok(name["isDirty"]() === true, "Updated Now Dirty");
        name["reset"]();
        assert.ok(name["isDirty"]() === false, "Reset OK");
        assert.ok(name() === "John", "Value Unchanged OK");
        name("Mark");
        assert.ok(name["isDirty"]() === true, "Updated again Now Dirty");
        name("John");
        assert.ok(name["isDirty"]() === false, "Original value re-entered Now Clean");
    });
    QUnit.test("Simple extend with object", function (assert) {
        var name;
        assert.throws(function () {
            name = ko.observable({}).extend({ dirtyFlag: {} });
        }, "Exception extending object observable");
    });
    QUnit.test("Extend With empty Key", function (assert) {
        var name;
        assert.throws(function () {
            var name = ko.observable("Joe Smith").extend({ dirtyFlag: { key: "" } });
        }, "Exception thrown if extending with empty key");
    });
    QUnit.test("Extend With Key, but no dirtyFlag2 instance", function (assert) {
        var name;
        assert.throws(function () {
            var name = ko.observable("Joe Smith").extend({ dirtyFlag: { key: "Tests1.name" } });
        }, "Exception thrown if extending with key that does not have matching dirtyFlag2");
    });
    QUnit.test("Extend With Key, existing dirtyFlag2 instance, test simple functionality", function (assert) {
        var name;
        var df = new dirtyFlag2_js_1.dirtyFlag2("Tests");
        name = ko.observable("Joe Smith").extend({ dirtyFlag: { key: "Tests.name" } });
        assert.ok(name["isDirty"]() === false, "Initialised as clean");
        name("John");
        assert.ok(name["isDirty"]() === true, "Updated Now Dirty");
        name["reset"]();
        assert.ok(name["isDirty"]() === false, "Reset OK");
        assert.ok(name() === "John", "Value Unchanged OK");
        name("Mark");
        assert.ok(name["isDirty"]() === true, "Updated again Now Dirty");
        name("John");
        assert.ok(name["isDirty"]() === false, "Original value re-entered Now Clean");
        df.dispose();
    });
    QUnit.test("Extend With Key, existing dirtyFlag2 instance, test dirtyFlag2 functionality", function (assert) {
        var name;
        var address;
        var df = new dirtyFlag2_js_1.dirtyFlag2("Tests1");
        name = ko.observable("Joe Smith").extend({ dirtyFlag: { key: "Tests1.name" } });
        address = ko.observable("1 High Street").extend({ dirtyFlag: { key: "Tests1.address" } });
        assert.ok(name["isDirty"]() === false, "Initialised as clean");
        name("John");
        assert.ok(df.isDirty() === true, "Updated Now Dirty");
        df.reset();
        assert.ok(df.isDirty() === false, "Reset OK");
        assert.ok(name() === "John", "Value Unchanged OK");
        name("Mark");
        assert.ok(df.isDirty() === true, "Updated again Now Dirty");
        name("John");
        assert.ok(df.isDirty() === false, "Original value re-entered Now Clean");
        name("Mark");
        assert.ok(df.isDirty() === true, "Updated again Now Dirty");
        df.reset("Tests1.address");
        assert.ok(df.isDirty() === true, "Reset another, still Dirty");
        df.reset("Tests1.name", "Paul");
        assert.ok(df.isDirty() === true, "Reset OK");
        assert.ok(name() === "Paul", "Value Changed OK");
        assert.throws(function () {
            df.reset("another");
        }, "Throws if resetting unknown root key");
        assert.throws(function () {
            df.reset("Tests.another");
        }, "Throws if resetting unknown leaf key");
        df.dispose();
        assert.throws(function () {
            df.dispose();
        }, "Throws if double disposal");
    });
    QUnit.test("Extend With Key, existing dirtyFlag2 instance, duplicate key", function (assert) {
        var name;
        var df = new dirtyFlag2_js_1.dirtyFlag2("Tests2");
        name = ko.observable("Joe Smith").extend({ dirtyFlag: { key: "Tests2.name" } });
        assert.throws(function () {
            var name2 = ko.observable("Joe Smith").extend({ dirtyFlag: { key: "Tests2.name" } });
        }, "trying to re-register key");
        df.dispose();
    });
    ///Array observable tests
    QUnit.test("Simple array extend test", function (assert) {
        var names;
        names = ko.observableArray(["Joe Smith"]).extend({ dirtyFlag: {} });
        assert.ok(names["isDirty"]() === false, "Initialised as clean");
        names.push("John");
        assert.ok(names["isDirty"]() === true, "Updated Now Dirty");
        names["reset"]();
        assert.ok(names["isDirty"]() === false, "Reset OK");
        //assert.ok(name() === "John", "Value Unchanged OK");
        names(["Joe Smith"]);
        assert.ok(names["isDirty"]() === true, "Updated again Now Dirty");
        names.push("John");
        assert.ok(names["isDirty"]() === false, "Array updated to match previously clean content, now clean.");
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUFNLENBQUMsQ0FBQztRQUNuQixNQUFNLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsRUFBRSxLQUFLLEtBQUssRUFBRSw2REFBNkQsQ0FBQyxDQUFDO0lBQzNHLENBQUMsQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3RzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGlydHlGbGFnMiB9IGZyb20gXCIuL2RpcnR5RmxhZzIuanNcIjtcclxuXHJcblFVbml0LnRlc3QoXCJTaW1wbGUgZXh0ZW5kIHRlc3RcIiwgZnVuY3Rpb24gKGFzc2VydCkge1xyXG4gICAgdmFyIG5hbWU6IEtub2Nrb3V0T2JzZXJ2YWJsZTxzdHJpbmc+O1xyXG4gICAgbmFtZSA9IGtvLm9ic2VydmFibGUoXCJKb2UgU21pdGhcIikuZXh0ZW5kKHsgZGlydHlGbGFnOiB7fSB9KTtcclxuXHJcbiAgICBhc3NlcnQub2sobmFtZVtcImlzRGlydHlcIl0oKSA9PT0gZmFsc2UsIFwiSW5pdGlhbGlzZWQgYXMgY2xlYW5cIik7XHJcblxyXG4gICAgbmFtZShcIkpvaG5cIik7XHJcbiAgICBhc3NlcnQub2sobmFtZVtcImlzRGlydHlcIl0oKSA9PT0gdHJ1ZSwgXCJVcGRhdGVkIE5vdyBEaXJ0eVwiKTtcclxuICAgIG5hbWVbXCJyZXNldFwiXSgpO1xyXG4gICAgYXNzZXJ0Lm9rKG5hbWVbXCJpc0RpcnR5XCJdKCkgPT09IGZhbHNlLCBcIlJlc2V0IE9LXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKG5hbWUoKSA9PT0gXCJKb2huXCIsIFwiVmFsdWUgVW5jaGFuZ2VkIE9LXCIpO1xyXG4gICAgbmFtZShcIk1hcmtcIik7XHJcbiAgICBhc3NlcnQub2sobmFtZVtcImlzRGlydHlcIl0oKSA9PT0gdHJ1ZSwgXCJVcGRhdGVkIGFnYWluIE5vdyBEaXJ0eVwiKTtcclxuICAgIG5hbWUoXCJKb2huXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKG5hbWVbXCJpc0RpcnR5XCJdKCkgPT09IGZhbHNlLCBcIk9yaWdpbmFsIHZhbHVlIHJlLWVudGVyZWQgTm93IENsZWFuXCIpO1xyXG59KTtcclxuXHJcblFVbml0LnRlc3QoXCJTaW1wbGUgZXh0ZW5kIHdpdGggb2JqZWN0XCIsIGZ1bmN0aW9uIChhc3NlcnQpIHtcclxuICAgIHZhciBuYW1lOiBLbm9ja291dE9ic2VydmFibGU8b2JqZWN0PjtcclxuICAgIGFzc2VydC50aHJvd3MoXHJcbiAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBuYW1lID0ga28ub2JzZXJ2YWJsZSh7fSkuZXh0ZW5kKHsgZGlydHlGbGFnOiB7fSB9KTtcclxuICAgICAgICB9LCBcIkV4Y2VwdGlvbiBleHRlbmRpbmcgb2JqZWN0IG9ic2VydmFibGVcIlxyXG4gICAgKTtcclxufSk7XHJcblFVbml0LnRlc3QoXCJFeHRlbmQgV2l0aCBlbXB0eSBLZXlcIiwgZnVuY3Rpb24gKGFzc2VydCkge1xyXG4gICAgdmFyIG5hbWU6IEtub2Nrb3V0T2JzZXJ2YWJsZTxzdHJpbmc+O1xyXG4gICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBuYW1lID0ga28ub2JzZXJ2YWJsZShcIkpvZSBTbWl0aFwiKS5leHRlbmQoeyBkaXJ0eUZsYWc6IHsga2V5OiBcIlwiIH0gfSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBcIkV4Y2VwdGlvbiB0aHJvd24gaWYgZXh0ZW5kaW5nIHdpdGggZW1wdHkga2V5XCJcclxuICAgICk7XHJcbn0pO1xyXG5cclxuUVVuaXQudGVzdChcIkV4dGVuZCBXaXRoIEtleSwgYnV0IG5vIGRpcnR5RmxhZzIgaW5zdGFuY2VcIiwgZnVuY3Rpb24gKGFzc2VydCkge1xyXG4gICAgdmFyIG5hbWU6IEtub2Nrb3V0T2JzZXJ2YWJsZTxzdHJpbmc+O1xyXG4gICAgYXNzZXJ0LnRocm93cyhcclxuICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBuYW1lID0ga28ub2JzZXJ2YWJsZShcIkpvZSBTbWl0aFwiKS5leHRlbmQoeyBkaXJ0eUZsYWc6IHsga2V5OiBcIlRlc3RzMS5uYW1lXCIgfSB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwiRXhjZXB0aW9uIHRocm93biBpZiBleHRlbmRpbmcgd2l0aCBrZXkgdGhhdCBkb2VzIG5vdCBoYXZlIG1hdGNoaW5nIGRpcnR5RmxhZzJcIlxyXG4gICAgKTtcclxufSk7XHJcblxyXG5RVW5pdC50ZXN0KFwiRXh0ZW5kIFdpdGggS2V5LCBleGlzdGluZyBkaXJ0eUZsYWcyIGluc3RhbmNlLCB0ZXN0IHNpbXBsZSBmdW5jdGlvbmFsaXR5XCIsIGZ1bmN0aW9uIChhc3NlcnQpIHtcclxuICAgIHZhciBuYW1lOiBLbm9ja291dE9ic2VydmFibGU8c3RyaW5nPjtcclxuICAgIHZhciBkZiA9IG5ldyBkaXJ0eUZsYWcyKFwiVGVzdHNcIik7XHJcbiAgICBuYW1lID0ga28ub2JzZXJ2YWJsZShcIkpvZSBTbWl0aFwiKS5leHRlbmQoeyBkaXJ0eUZsYWc6IHsga2V5OiBcIlRlc3RzLm5hbWVcIiB9IH0pO1xyXG4gICAgYXNzZXJ0Lm9rKG5hbWVbXCJpc0RpcnR5XCJdKCkgPT09IGZhbHNlLCBcIkluaXRpYWxpc2VkIGFzIGNsZWFuXCIpO1xyXG5cclxuICAgIG5hbWUoXCJKb2huXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKG5hbWVbXCJpc0RpcnR5XCJdKCkgPT09IHRydWUsIFwiVXBkYXRlZCBOb3cgRGlydHlcIik7XHJcbiAgICBuYW1lW1wicmVzZXRcIl0oKTtcclxuICAgIGFzc2VydC5vayhuYW1lW1wiaXNEaXJ0eVwiXSgpID09PSBmYWxzZSwgXCJSZXNldCBPS1wiKTtcclxuICAgIGFzc2VydC5vayhuYW1lKCkgPT09IFwiSm9oblwiLCBcIlZhbHVlIFVuY2hhbmdlZCBPS1wiKTtcclxuICAgIG5hbWUoXCJNYXJrXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKG5hbWVbXCJpc0RpcnR5XCJdKCkgPT09IHRydWUsIFwiVXBkYXRlZCBhZ2FpbiBOb3cgRGlydHlcIik7XHJcbiAgICBuYW1lKFwiSm9oblwiKTtcclxuICAgIGFzc2VydC5vayhuYW1lW1wiaXNEaXJ0eVwiXSgpID09PSBmYWxzZSwgXCJPcmlnaW5hbCB2YWx1ZSByZS1lbnRlcmVkIE5vdyBDbGVhblwiKTtcclxuICAgIGRmLmRpc3Bvc2UoKTtcclxufSk7XHJcblxyXG5RVW5pdC50ZXN0KFwiRXh0ZW5kIFdpdGggS2V5LCBleGlzdGluZyBkaXJ0eUZsYWcyIGluc3RhbmNlLCB0ZXN0IGRpcnR5RmxhZzIgZnVuY3Rpb25hbGl0eVwiLCBmdW5jdGlvbiAoYXNzZXJ0KSB7XHJcbiAgICB2YXIgbmFtZTogS25vY2tvdXRPYnNlcnZhYmxlPHN0cmluZz47XHJcbiAgICB2YXIgYWRkcmVzczogS25vY2tvdXRPYnNlcnZhYmxlPHN0cmluZz47XHJcbiAgICB2YXIgZGYgPSBuZXcgZGlydHlGbGFnMihcIlRlc3RzMVwiKTtcclxuICAgIG5hbWUgPSBrby5vYnNlcnZhYmxlKFwiSm9lIFNtaXRoXCIpLmV4dGVuZCh7IGRpcnR5RmxhZzogeyBrZXk6IFwiVGVzdHMxLm5hbWVcIiB9IH0pO1xyXG4gICAgYWRkcmVzcyA9IGtvLm9ic2VydmFibGUoXCIxIEhpZ2ggU3RyZWV0XCIpLmV4dGVuZCh7IGRpcnR5RmxhZzogeyBrZXk6IFwiVGVzdHMxLmFkZHJlc3NcIiB9IH0pO1xyXG4gICAgYXNzZXJ0Lm9rKG5hbWVbXCJpc0RpcnR5XCJdKCkgPT09IGZhbHNlLCBcIkluaXRpYWxpc2VkIGFzIGNsZWFuXCIpO1xyXG5cclxuICAgIG5hbWUoXCJKb2huXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKGRmLmlzRGlydHkoKSA9PT0gdHJ1ZSwgXCJVcGRhdGVkIE5vdyBEaXJ0eVwiKTtcclxuICAgIGRmLnJlc2V0KCk7XHJcbiAgICBhc3NlcnQub2soZGYuaXNEaXJ0eSgpID09PSBmYWxzZSwgXCJSZXNldCBPS1wiKTtcclxuICAgIGFzc2VydC5vayhuYW1lKCkgPT09IFwiSm9oblwiLCBcIlZhbHVlIFVuY2hhbmdlZCBPS1wiKTtcclxuICAgIG5hbWUoXCJNYXJrXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKGRmLmlzRGlydHkoKSA9PT0gdHJ1ZSwgXCJVcGRhdGVkIGFnYWluIE5vdyBEaXJ0eVwiKTtcclxuICAgIG5hbWUoXCJKb2huXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKGRmLmlzRGlydHkoKSA9PT0gZmFsc2UsIFwiT3JpZ2luYWwgdmFsdWUgcmUtZW50ZXJlZCBOb3cgQ2xlYW5cIik7XHJcbiAgICBuYW1lKFwiTWFya1wiKTtcclxuICAgIGFzc2VydC5vayhkZi5pc0RpcnR5KCkgPT09IHRydWUsIFwiVXBkYXRlZCBhZ2FpbiBOb3cgRGlydHlcIik7XHJcbiAgICBkZi5yZXNldChcIlRlc3RzMS5hZGRyZXNzXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKGRmLmlzRGlydHkoKSA9PT0gdHJ1ZSwgXCJSZXNldCBhbm90aGVyLCBzdGlsbCBEaXJ0eVwiKTtcclxuICAgIGRmLnJlc2V0KFwiVGVzdHMxLm5hbWVcIiwgXCJQYXVsXCIpO1xyXG4gICAgYXNzZXJ0Lm9rKGRmLmlzRGlydHkoKSA9PT0gdHJ1ZSwgXCJSZXNldCBPS1wiKTtcclxuICAgIGFzc2VydC5vayhuYW1lKCkgPT09IFwiUGF1bFwiLCBcIlZhbHVlIENoYW5nZWQgT0tcIik7XHJcbiAgICBhc3NlcnQudGhyb3dzKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBkZi5yZXNldChcImFub3RoZXJcIik7XHJcbiAgICB9LCBcIlRocm93cyBpZiByZXNldHRpbmcgdW5rbm93biByb290IGtleVwiKTtcclxuICAgIGFzc2VydC50aHJvd3MoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGRmLnJlc2V0KFwiVGVzdHMuYW5vdGhlclwiKTtcclxuICAgIH0sIFwiVGhyb3dzIGlmIHJlc2V0dGluZyB1bmtub3duIGxlYWYga2V5XCIpO1xyXG4gICAgZGYuZGlzcG9zZSgpO1xyXG5cclxuICAgIGFzc2VydC50aHJvd3MoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGRmLmRpc3Bvc2UoKTtcclxuICAgIH0sIFwiVGhyb3dzIGlmIGRvdWJsZSBkaXNwb3NhbFwiKTtcclxufSk7XHJcblxyXG5RVW5pdC50ZXN0KFwiRXh0ZW5kIFdpdGggS2V5LCBleGlzdGluZyBkaXJ0eUZsYWcyIGluc3RhbmNlLCBkdXBsaWNhdGUga2V5XCIsIGZ1bmN0aW9uIChhc3NlcnQpIHtcclxuICAgIHZhciBuYW1lOiBLbm9ja291dE9ic2VydmFibGU8c3RyaW5nPjtcclxuICAgIHZhciBkZiA9IG5ldyBkaXJ0eUZsYWcyKFwiVGVzdHMyXCIpO1xyXG4gICAgbmFtZSA9IGtvLm9ic2VydmFibGUoXCJKb2UgU21pdGhcIikuZXh0ZW5kKHsgZGlydHlGbGFnOiB7IGtleTogXCJUZXN0czIubmFtZVwiIH0gfSk7XHJcbiAgICBhc3NlcnQudGhyb3dzKFxyXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIG5hbWUyID0ga28ub2JzZXJ2YWJsZShcIkpvZSBTbWl0aFwiKS5leHRlbmQoeyBkaXJ0eUZsYWc6IHsga2V5OiBcIlRlc3RzMi5uYW1lXCIgfSB9KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIFwidHJ5aW5nIHRvIHJlLXJlZ2lzdGVyIGtleVwiXHJcbiAgICApO1xyXG4gICAgZGYuZGlzcG9zZSgpO1xyXG59KTtcclxuXHJcbi8vL0FycmF5IG9ic2VydmFibGUgdGVzdHNcclxuXHJcblFVbml0LnRlc3QoXCJTaW1wbGUgYXJyYXkgZXh0ZW5kIHRlc3RcIiwgZnVuY3Rpb24gKGFzc2VydCkge1xyXG4gICAgdmFyIG5hbWVzOiBLbm9ja291dE9ic2VydmFibGVBcnJheTxzdHJpbmc+O1xyXG4gICAgbmFtZXMgPSBrby5vYnNlcnZhYmxlQXJyYXkoW1wiSm9lIFNtaXRoXCJdKS5leHRlbmQoeyBkaXJ0eUZsYWc6IHt9IH0pO1xyXG5cclxuICAgIGFzc2VydC5vayhuYW1lc1tcImlzRGlydHlcIl0oKSA9PT0gZmFsc2UsIFwiSW5pdGlhbGlzZWQgYXMgY2xlYW5cIik7XHJcblxyXG4gICAgbmFtZXMucHVzaChcIkpvaG5cIik7XHJcbiAgICBhc3NlcnQub2sobmFtZXNbXCJpc0RpcnR5XCJdKCkgPT09IHRydWUsIFwiVXBkYXRlZCBOb3cgRGlydHlcIik7XHJcbiAgICBuYW1lc1tcInJlc2V0XCJdKCk7XHJcbiAgICBhc3NlcnQub2sobmFtZXNbXCJpc0RpcnR5XCJdKCkgPT09IGZhbHNlLCBcIlJlc2V0IE9LXCIpO1xyXG4gICAgLy9hc3NlcnQub2sobmFtZSgpID09PSBcIkpvaG5cIiwgXCJWYWx1ZSBVbmNoYW5nZWQgT0tcIik7XHJcbiAgICBuYW1lcyhbXCJKb2UgU21pdGhcIl0pO1xyXG4gICAgYXNzZXJ0Lm9rKG5hbWVzW1wiaXNEaXJ0eVwiXSgpID09PSB0cnVlLCBcIlVwZGF0ZWQgYWdhaW4gTm93IERpcnR5XCIpO1xyXG4gICAgbmFtZXMucHVzaChcIkpvaG5cIik7XHJcbiAgICBhc3NlcnQub2sobmFtZXNbXCJpc0RpcnR5XCJdKCkgPT09IGZhbHNlLCBcIkFycmF5IHVwZGF0ZWQgdG8gbWF0Y2ggcHJldmlvdXNseSBjbGVhbiBjb250ZW50LCBub3cgY2xlYW4uXCIpO1xyXG59KTtcclxuIl19
